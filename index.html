<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cheeky Commodore Gamer | Games Database</title>
    
    <meta name="description" content="Browse the full Commodore 64 and Amiga Games Database! Instantly watch video reviews, explore game genres, and find emulator-ready files.">
    <link rel="canonical" href="https://www.cheekycommodoregamer.co.uk/games">
    
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <link href="https://db.onlinewebfonts.com/c/05eb10077a913e99089a693039e6273e?family=Amiga+Topaz" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet"> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <link rel="stylesheet" href="../css/style.css">

    <style>
        /* --- HOME PAGE SPECIFIC STYLES --- */
        :root {
            --c64-blue: #352879; --c64-light-blue: #6c5eb5; --c64-text: #b8c76f; --c64-red: #880000;
            --c64-cyan: #00ffff; --c64-yellow: #feff6c;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }

        body { font-family: 'VT323', monospace; margin: 0; padding: 0; min-height: 100vh; display: flex; flex-direction: column; align-items: center; text-transform: uppercase; overflow-x: hidden; }

        /* --- STARFIELD & CRT --- */
        #starfield { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; opacity: 0.3; }
        .crt-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06)); background-size: 100% 2px, 3px 100%; pointer-events: none; z-index: 9999; }

        /* --- MAIN CONTAINER --- */
        .container {
            width: 95%; max-width: 900px; padding: 25px; 
            position: relative; margin-top: 20px; margin-bottom: 60px;
            border: 4px solid var(--c64-light-blue); 
            background-color: rgba(53, 40, 121, 0.95); 
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            z-index: 10;
        }

        /* --- TYPOGRAPHY & HEADERS --- */
        h1 { font-size: 2rem; color: #fff; margin: 0 0 10px 0; text-align: center; font-weight: normal; animation: textFlicker 0.15s infinite alternate; }
        h2 { font-size: 1.5rem; color: var(--c64-cyan); margin: 20px 0 10px 0; text-align: center; font-weight: normal; text-shadow: 0 0 5px var(--c64-cyan); border-bottom: 1px dashed var(--c64-light-blue); padding-bottom: 5px; display: flex; justify-content: center; align-items: center; gap: 10px; }
        p { font-size: 1.2rem; margin-bottom: 15px; text-align: center; line-height: 1.4; }
        
        /* --- SEARCH INPUT (Only on this page) --- */
        .search-wrapper { margin-bottom: 25px; position: relative; }
        .search-input { width: 100%; background: #000; color: var(--c64-text); border: 2px solid var(--c64-light-blue); padding: 12px; font-family: 'VT323', monospace; font-size: 1.4rem; text-transform: uppercase; outline: none; }
        .search-results { display: none; background: #000; border: 2px solid var(--c64-light-blue); border-top: none; max-height: 300px; overflow-y: auto; width: 100%; position: absolute; z-index: 100; }
        .search-results.active { display: block; }
        .result-item { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px dashed #333; color: #fff; cursor: pointer; font-size: 1.2rem; }
        .result-item:hover { background: var(--c64-light-blue); }

        /* --- VIDEO SPOTLIGHT --- */
        .monitor-wrapper { background: #000; border: 4px solid #444; border-radius: 10px; padding: 10px; margin: 20px auto; max-width: 600px; box-shadow: 0 0 15px rgba(0,255,255,0.2); }
        .monitor-screen { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; background: #000; }
        .monitor-screen iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0; }
        .loading-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); animation: blink 1s infinite; }

        /* --- BUTTON GRID --- */
        .btn-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 25px; width: 100%; }
        .btn-retro { background: var(--c64-light-blue); color: #fff; border: 2px solid #fff; padding: 15px 20px; font-family: inherit; font-size: 1.4rem; cursor: pointer; display: flex; justify-content: center; align-items: center; gap: 10px; text-align: center; transition: all 0.1s; text-transform: uppercase; width: 100%; text-decoration: none; }
        .btn-retro:hover { background: #fff; color: var(--c64-blue); }
        .btn-emphasise { border-color: var(--c64-cyan) !important; color: var(--c64-cyan) !important; text-shadow: 0 0 8px var(--c64-cyan); animation: glow-pulse 2s infinite alternate; }
        .btn-emphasise:hover { background: var(--c64-cyan) !important; color: var(--c64-blue) !important; text-shadow: none; }

        @keyframes glow-pulse { 0% { box-shadow: 0 0 8px rgba(0, 255, 255, 0.5); } 100% { box-shadow: 0 0 15px rgba(0, 255, 255, 1), 0 0 5px rgba(0, 255, 255, 0.8); } }

        /* --- MARQUEE --- */
        .marquee-container { position: fixed; bottom: 0; left: 0; width: 100%; background: var(--c64-light-blue); color: #fff; padding: 5px 0; border-top: 2px solid #fff; z-index: 100; overflow: hidden; white-space: nowrap; display: block; }
        .marquee-content { display: inline-block; padding-left: 100%; animation: marquee 20s linear infinite; font-size: 1.2rem; }
        @keyframes marquee { 0% { transform: translate(0, 0); } 100% { transform: translate(-100%, 0); } }

        /* --- MOBILE FIXES --- */
        @media (max-width: 600px) {
            .container { padding: 10px 5px; margin-top: 5px; }
            h1 { font-size: 1.8rem; }
            .btn-grid { grid-template-columns: 1fr; gap: 12px; }
        }
    </style>
</head>
<body>

    <canvas id="starfield"></canvas>
    <div class="crt-overlay"></div>

    <div id="global-header-container"></div>

    <div class="container" id="main-container">

        <div class="commodore-header">
            <img src="../images/CCGAMER_LOGO.png" alt="Cheeky Commodore Gamer Logo - Retro Gaming Hub" style="max-width: 150px; image-rendering: pixelated; margin-bottom: 10px;">
            <h3>GAMES DATABASE</h3>
            <p>64K RAM SYSTEM 38911 BASIC BYTES FREE</p>
        </div>

        <div style="text-align: center; margin-bottom: 30px; min-height: 80px;">
            <h1 id="typewriter-text"></h1>
            <p id="typewriter-sub" style="color: var(--c64-light-blue);">READY.<span class="cursor"></span></p>
        </div>
        
        <h2>COMMAND LINE: SEARCH C64 AND AMIGA TITLES</h2>

        <div class="search-wrapper">
            <input type="text" class="search-input" id="homeSearch" placeholder="INITIALIZING DATABASE..." disabled>
            <div class="search-results" id="homeSearchResults">
                <div style="padding:10px; text-align:center;" class="blink">LOADING DATA...</div>
            </div>
        </div>
        
        <h2>GAME OF THE MOMENT</h2>
        <div class="monitor-wrapper">
            <div class="monitor-screen" id="spotlightVideo">
                <div style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); color:#fff;" class="loading-text">LOADING VIDEO SIGNAL...</div>
            </div>
        </div>

        <h2>QUICK ACCESS: BROWSE GAME SECTIONS</h2>

        <div class="btn-grid">
            <a href="index.html" class="btn-retro play-sound btn-emphasise">
                <i class="fa-solid fa-folder-open"></i> BROWSE GENRES
            </a>
            <a href="complete-index.html" class="btn-retro play-sound">
                <i class="fa-solid fa-sort-alpha-down"></i> FULL INDEX
            </a>
            <a href="../resources/quiz.html" class="btn-retro play-sound">
                <i class="fa-solid fa-brain"></i> RETRO QUIZ
            </a>
        </div>
        
        <h2>SUPPORT AND SOCIAL CHANNELS</h2>

        <div class="btn-grid">
            <a href="https://www.youtube.com/@CheekyCommodoreGamer?sub_confirmation=1" target="_blank" class="btn-retro play-sound" style="border-color: var(--c64-red);">
                <i class="fa-brands fa-youtube"></i> SUBSCRIBE
            </a>
            <a href="https://www.paypal.com/donate/?hosted_button_id=LGG86ZV9P4YKL" target="_blank" class="btn-retro play-sound" style="border-color: var(--c64-green);">
                <i class="fa-solid fa-hand-holding-dollar"></i> DONATE
            </a>
        </div>

        <div class="stats-box">
            <span id="visitorCount">VISITORS: 0</span>
            <span>|</span>
            <span id="gamesCount">GAMES: 0</span>
        </div>

    </div>

    <div class="marquee-container" id="marquee">
        <div class="marquee-content">
             *** WELCOME TO CHEEKY COMMODORE GAMER *** UPDATED DAILY WITH NEW C64 & AMIGA TITLES *** CHECK OUT THE NEW QUIZ SECTION *** DON'T FORGET TO SUBSCRIBE ON YOUTUBE *** PRESS PLAY ON TAPE ***
        </div>
    </div>

    <script src="../js/global.js"></script>

    <script>
        // Use a relative path for the logo image since this file is in /games/
        document.querySelector('.commodore-header img').src = '../' + document.querySelector('.commodore-header img').getAttribute('src');

        // ==========================================
        // CONFIGURATION & LOGIC
        // ==========================================
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwhkSGA6HcSvCljqBA91JmQVsVVUPU5LCEO1HlifB_Cjwc0DTFCK3m6hG5ZFDSgVHw9/exec';
        const API_KEY = "AIzaSyABtgqVHmOrfzw2DLE-3ta3OmlaQ0ad_t8";
        const C64_PLAYLIST_ID = "PL_TYjnCNYSex7dxxCMMuOsjzcXE1VNiR9";
        const AMIGA_PLAYLIST_ID = "PL_TYjnCNYSezw55SVAMN2_UhdH3gCca1n";

        let allGames = [];
        let loadingAborted = false;

        // --- TYPEWRITER HELPER ---
        const typeText = (elementId, text, delay = 50) => {
            return new Promise(resolve => {
                if (loadingAborted) { resolve(); return; }
                const el = document.getElementById(elementId);
                el.textContent = ""; // Clear existing content for fresh typing
                const cursor = document.createElement('span');
                cursor.className = 'cursor';
                
                let i = 0;
                const timer = setInterval(() => {
                    if (loadingAborted) { clearInterval(timer); resolve(); return; }
                    el.textContent += text.charAt(i);
                    el.appendChild(cursor); // Keep cursor at end
                    i++;
                    if (i >= text.length) {
                        clearInterval(timer);
                        resolve();
                    }
                }, delay);
            });
        };
        
        // --- START SYSTEM ---
        function startSystem() {
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('loading-screen').style.display = 'flex';
            load(); 
            fetchStats();
        }

        // --- FETCH STATS (Modified to track visit only once per session/day) ---
        function fetchStats() {
            try {
                const today = new Date().toDateString();
                // We track the visitor here, and get the counts asynchronously
                if (localStorage.getItem('ccg_visited_today') !== today) {
                    fetch(`${SCRIPT_URL}?action=trackVisitor`, {method:'POST'}).catch(()=>{});
                    localStorage.setItem('ccg_visited_today', today);
                }
                
                fetch(`${SCRIPT_URL}?getCounters=true&t=${Date.now()}`).then(r=>r.json()).then(cRes => {
                    if (cRes.visitors) document.getElementById('visitorCount').textContent = `VISITORS: ${cRes.visitors}`;
                    if (cRes.total_games) document.getElementById('gamesCount').textContent = `GAMES: ${cRes.total_games}`;
                }).catch(()=>{ /* silent fail */ });
            } catch(e) {}
        }

        // --- SKIP LOADING ---
        function skipLoading() {
            loadingAborted = true;
            document.getElementById('loading-screen').style.display = 'none';
            document.getElementById('main-container').style.display = 'block';
            document.getElementById('marquee').style.display = 'block';
            typeText("typewriter-text", "COMMODORE 64 & AMIGA: THE ULTIMATE RETRO GAMING DATABASE", 1);
            document.getElementById('homeSearch').placeholder = `SEARCH TITLES...`;
            document.getElementById('homeSearch').removeAttribute('disabled');
            // If videos haven't loaded, call the video function immediately to load them
            if (!document.querySelector('#spotlightVideo iframe')) {
                setupFeaturedGames();
            }
        }

        // --- LOADING SEQUENCE ---
        const runLoadingSequence = async () => {
            const terminal = document.getElementById('loading-terminal');
            const rasterBars = document.getElementById('rasterBars');
            
            await typeText('loading-terminal', 'LOAD ""', 80);
            await new Promise(r => setTimeout(r, 500));
            if(loadingAborted) return;
            terminal.innerHTML += '<br>';
            
            await new Promise(r => setTimeout(r, 500));
            if(loadingAborted) return;
            terminal.innerHTML += 'PRESS PLAY ON TAPE<br>';
            
            const audio = new Audio("https://raw.githubusercontent.com/joepentony-dot/website-images/main/STAYAWHILE.mp3");
            audio.volume = 0.7;
            audio.play().catch(e => console.log("Audio play failed:", e));

            await new Promise(r => setTimeout(r, 1500));
            if(loadingAborted) return;
            terminal.innerHTML += 'OK<br>';
            await new Promise(r => setTimeout(r, 800));
            if(loadingAborted) return;
            
            terminal.innerHTML += '<span style="background-color:var(--c64-blue); color:var(--c64-light-blue); padding:2px 8px; box-shadow:4px 4px 0px rgba(0,0,0,0.5);">SEARCHING</span><br>';
            await new Promise(r => setTimeout(r, 1000));
            if(loadingAborted) return;
            
            terminal.innerHTML += '<span style="background-color:var(--c64-blue); color:var(--c64-yellow); padding:2px 8px; box-shadow:4px 4px 0px rgba(0,0,0,0.5);">FOUND CHEEKY COMMODORE GAMER</span><br>';
            await new Promise(r => setTimeout(r, 1200));
            if(loadingAborted) return;
            
            terminal.innerHTML += '<span style="background-color:var(--c64-blue); color:var(--c64-green); padding:2px 8px; box-shadow:4px 4px 0px rgba(0,0,0,0.5);">LOADING</span><br>';
            if(loadingAborted) return;
            
            rasterBars.style.display = 'block';
            
            await new Promise(r => setTimeout(r, 3000));
            
            if(!loadingAborted) {
                rasterBars.style.display = 'none';
                document.getElementById('loading-screen').style.display = 'none';
                document.getElementById('main-container').style.display = 'block';
                document.getElementById('marquee').style.display = 'block';
                typeText("typewriter-text", "COMMODORE 64 & AMIGA: THE ULTIMATE RETRO GAMING DATABASE", 40);
                document.getElementById('homeSearch').placeholder = `SEARCH TITLES...`;
                document.getElementById('homeSearch').removeAttribute('disabled');
            }
        };

        // --- SEARCH DATA FETCHING ---
        async function fetchGameData() {
            try {
                // Using the Complete Index endpoint to grab all relevant data once
                const response = await fetch("https://docs.google.com/spreadsheets/d/e/2PACX-1vQWiuznK7CJeHvaMSAmdVyzDEdpeNQxXGjhqEzsvzLTV792D_B1B5pA55T6kV7maskDFkn0oU0CQ3JM/pub?gid=1584452405&single=true&output=csv");
                const csvText = await response.text();
                
                return new Promise(resolve => {
                    Papa.parse(csvText, {
                        header: true,
                        skipEmptyLines: true,
                        complete: results => {
                            resolve(results.data.map(g => ({
                                title: g.gametitle || '',
                                genre: g.genre || '',
                                video: g.videoid || ''
                            })).filter(g => g.title));
                        },
                        error: () => resolve([])
                    });
                });
            } catch (e) {
                console.error("Error fetching game data:", e);
                return [];
            }
        }

        async function load() {
            allGames = await fetchGameData();
            // Rest of the load logic is handled inside runLoadingSequence completion or skipLoading
        }
        
        // --- YOUTUBE FETCHING (Minimal to grab random video) ---
        function displayVideo(containerId, videoId) { 
            const container = document.getElementById(containerId);
            if (!container) return; 
            container.innerHTML = `<iframe src="https://www.youtube.com/embed/${videoId}?autoplay=1&mute=1&controls=0&rel=0&showinfo=0&loop=1&playlist=${videoId}" title="YouTube" frameborder="0" allow="autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`; 
        }

        async function setupFeaturedGames() { 
            if (allGames.length === 0) return;

            const c64Games = allGames.filter(g => g.genre.includes('C64') && g.video);
            const amigaGames = allGames.filter(g => g.genre.includes('Amiga') && g.video);

            const allVideos = [...c64Games, ...amigaGames];

            if(allVideos.length > 0) {
                const randomGame = allVideos[Math.floor(Math.random() * allVideos.length)];
                displayVideo("spotlightVideo", randomGame.video);
            }
        }
        
        // --- SEARCH & FILTER LOGIC ---
        const input = document.getElementById('homeSearch');
        const results = document.getElementById('homeSearchResults');

        input.addEventListener('input', () => {
            const q = input.value.toLowerCase().trim();
            results.innerHTML = '';
            if (allGames.length === 0 || q.length < 2) { 
                results.classList.remove('active'); 
                return; 
            }
            
            const matches = allGames.filter(g => g.title.toLowerCase().includes(q)).slice(0, 10);
            
            if (!matches.length) {
                results.innerHTML = '<div style="padding:10px; text-align:center;">?FILE NOT FOUND</div>';
            } else {
                results.innerHTML = matches.map(g => `
                    <div class="result-item play-sound" onclick="window.open('https://www.youtube.com/watch?v=${g.video}', '_blank')">
                        <span>${g.title}</span>
                        <span style="color:var(--c64-text); font-size:0.9rem;">[${g.genre}]</span>
                    </div>`).join('');
            }
            results.classList.add('active');
        });

        // Search redirection (Enter Key)
        input.addEventListener('keypress', e => { 
            if(e.key === 'Enter' && input.value.trim()) {
                // Direct users to the master index with the search query
                location.href = `games/complete-index.html?search=${encodeURIComponent(input.value.trim())}`;
            }
        });

        // Initial setup calls
        document.addEventListener('DOMContentLoaded', async () => {
            // Check if we are past the start screen (e.g., if reloaded after a cheat)
            if (document.getElementById('start-screen').style.display !== 'none') {
                document.getElementById('start-screen').style.display = 'flex';
                // Load data for the search bar immediately if needed later
                allGames = await fetchGameData();
            } else {
                // If we land directly here (e.g., from a back button), skip loading screen
                skipLoading();
            }
            fetchStats();
            setupFeaturedGames();
        });
    </script>
</body>
</html>
